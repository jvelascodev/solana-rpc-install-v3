# æ–‡ä»¶ç³»ç»Ÿæ”¯æŒæ›´æ–°è¯´æ˜

## ğŸ¯ æ›´æ–°å†…å®¹

### æ”¯æŒå¤šç§æ–‡ä»¶ç³»ç»Ÿï¼ˆv1.2ï¼‰

**ä¹‹å‰çš„é—®é¢˜**ï¼š
- âŒ è„šæœ¬ç¡¬ç¼–ç ä¸º ext4
- âŒ ä¸æ”¯æŒå·²æœ‰çš„ XFS ç£ç›˜
- âŒ fstab æ€»æ˜¯å†™å…¥ ext4ï¼Œå³ä½¿ç£ç›˜æ˜¯ XFS
- âŒ å¯¼è‡´æŒ‚è½½åæ–‡ä»¶ç³»ç»Ÿç±»å‹ä¸åŒ¹é…

**ç°åœ¨çš„æ”¹è¿›**ï¼š
- âœ… è‡ªåŠ¨æ£€æµ‹ç°æœ‰æ–‡ä»¶ç³»ç»Ÿç±»å‹ï¼ˆXFS, EXT4, ç­‰ï¼‰
- âœ… ä¿ç•™ç°æœ‰æ–‡ä»¶ç³»ç»Ÿï¼Œä¸å¼ºåˆ¶æ ¼å¼åŒ–
- âœ… fstab è®°å½•å®é™…çš„æ–‡ä»¶ç³»ç»Ÿç±»å‹
- âœ… åªåœ¨å…¨æ–°ç£ç›˜ä¸Šåˆ›å»º ext4
- âœ… æ”¯æŒä»»ä½• Linux æ”¯æŒçš„æ–‡ä»¶ç³»ç»Ÿ

---

## ğŸ“ ä¿®æ”¹è¯¦æƒ…

### 1. `1-prepare.sh` - mount_one() å‡½æ•°

**ä¿®æ”¹å‰**ï¼š
```bash
# å¦‚æœæ²¡æœ‰æ–‡ä»¶ç³»ç»Ÿï¼Œåˆ›å»º ext4
if ! has_fs "$dev"; then
    mkfs.ext4 -F "$dev"
fi

mount -o defaults "$dev" "$target"
echo "$dev $target ext4 defaults 0 0" >> /etc/fstab  # âŒ ç¡¬ç¼–ç  ext4
```

**ä¿®æ”¹å**ï¼š
```bash
# æ£€æµ‹æˆ–åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿ
local fs_type=""
if has_fs "$dev"; then
    # æ£€æµ‹ç°æœ‰æ–‡ä»¶ç³»ç»Ÿç±»å‹
    fs_type=$(blkid -o value -s TYPE "$dev" 2>/dev/null || echo "")
    if [[ -n "$fs_type" ]]; then
        echo "   - æ£€æµ‹åˆ°ç°æœ‰æ–‡ä»¶ç³»ç»Ÿï¼š$fs_typeï¼Œä¿ç•™"  # âœ… ä¿ç•™ XFS/EXT4
    else
        fs_type="auto"
    fi
else
    # åªåœ¨æ²¡æœ‰æ–‡ä»¶ç³»ç»Ÿæ—¶æ‰åˆ›å»º ext4
    mkfs.ext4 -F "$dev" >/dev/null 2>&1
    fs_type="ext4"
fi

mount "$dev" "$target"
echo "$dev $target $fs_type defaults 0 0" >> /etc/fstab  # âœ… ä½¿ç”¨å®é™…ç±»å‹
```

### 2. `fix-mount-priority.sh` - mount_to_target() å‡½æ•°

åŒæ ·çš„æ”¹è¿›ï¼Œç¡®ä¿ä¸¤ä¸ªè„šæœ¬è¡Œä¸ºä¸€è‡´ã€‚

---

## ğŸ” æ”¯æŒçš„æ–‡ä»¶ç³»ç»Ÿ

### è‡ªåŠ¨ä¿ç•™çš„æ–‡ä»¶ç³»ç»Ÿ
- âœ… **XFS** - Solana æ¨èï¼Œå¤§æ–‡ä»¶æ€§èƒ½ä¼˜ç§€
- âœ… **EXT4** - ä¼ ç»Ÿé€‰æ‹©ï¼Œç¨³å®šå¯é 
- âœ… **EXT3** - æ—§ç³»ç»Ÿå…¼å®¹
- âœ… **BTRFS** - å¦‚æœç”¨æˆ·å·²ä½¿ç”¨
- âœ… ä»»ä½• `blkid` èƒ½æ£€æµ‹çš„æ–‡ä»¶ç³»ç»Ÿ

### æ–°ç£ç›˜é»˜è®¤æ ¼å¼åŒ–
- ğŸ“¦ **EXT4** - ä½œä¸ºé»˜è®¤é€‰æ‹©ï¼ˆå…¼å®¹æ€§å¥½ï¼‰

---

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

### XFS vs EXT4 for Solana

| ç‰¹æ€§ | XFS | EXT4 | æ¨èç”¨é€” |
|------|-----|------|---------|
| **å¤§æ–‡ä»¶æ€§èƒ½** | â­â­â­â­â­ | â­â­â­â­ | Ledger/Snapshot |
| **å°æ–‡ä»¶æ€§èƒ½** | â­â­â­â­ | â­â­â­â­â­ | Accounts |
| **å¹¶å‘å†™å…¥** | â­â­â­â­â­ | â­â­â­â­ | æ‰€æœ‰ç›®å½• |
| **æˆç†Ÿåº¦** | â­â­â­â­ | â­â­â­â­â­ | - |
| **æ¢å¤å·¥å…·** | â­â­â­ | â­â­â­â­â­ | - |

**ç»“è®º**ï¼š
- å¯¹äº Solana RPC èŠ‚ç‚¹ï¼ŒXFS å’Œ EXT4 æ€§èƒ½å·®å¼‚ < 5%
- **ç£ç›˜æ˜¯å¦ç‹¬ç«‹** >> æ–‡ä»¶ç³»ç»Ÿç±»å‹
- ä¸¤è€…éƒ½æ˜¯ä¼˜ç§€çš„é€‰æ‹©ï¼Œè„šæœ¬ç°åœ¨éƒ½æ”¯æŒ

---

## ğŸš€ ä½¿ç”¨æ–¹å¼

### åœºæ™¯ 1ï¼šå…¨æ–°ç£ç›˜ï¼ˆè‡ªåŠ¨åˆ›å»º EXT4ï¼‰

```bash
# ç£ç›˜æ— æ–‡ä»¶ç³»ç»Ÿ
bash 1-prepare.sh

# è¾“å‡ºï¼š
# - ä¸º /dev/nvme0n1 åˆ›å»º ext4 æ–‡ä»¶ç³»ç»Ÿï¼ˆé¦–æ¬¡ä½¿ç”¨ï¼‰
# - âœ… æŒ‚è½½å®Œæˆï¼š/dev/nvme0n1 -> /root/sol/accounts (ext4)
```

### åœºæ™¯ 2ï¼šå·²æœ‰ XFS ç£ç›˜ï¼ˆä¿ç•™ XFSï¼‰

```bash
# ç£ç›˜å·²æ ¼å¼åŒ–ä¸º XFS
bash 1-prepare.sh

# è¾“å‡ºï¼š
# - æ£€æµ‹åˆ°ç°æœ‰æ–‡ä»¶ç³»ç»Ÿï¼šxfsï¼Œä¿ç•™
# - âœ… æŒ‚è½½å®Œæˆï¼š/dev/nvme0n1 -> /root/sol/accounts (xfs)
```

### åœºæ™¯ 3ï¼šæ··åˆæ–‡ä»¶ç³»ç»Ÿï¼ˆè‡ªåŠ¨å¤„ç†ï¼‰

```bash
# nvme0n1 æ˜¯ XFSï¼Œnvme1n1 æ˜¯ EXT4
bash 1-prepare.sh

# è¾“å‡ºï¼š
# - æ£€æµ‹åˆ°ç°æœ‰æ–‡ä»¶ç³»ç»Ÿï¼šxfsï¼Œä¿ç•™
# - âœ… æŒ‚è½½å®Œæˆï¼š/dev/nvme0n1 -> /root/sol/accounts (xfs)
# - æ£€æµ‹åˆ°ç°æœ‰æ–‡ä»¶ç³»ç»Ÿï¼šext4ï¼Œä¿ç•™
# - âœ… æŒ‚è½½å®Œæˆï¼š/dev/nvme1n1 -> /root/sol/ledger (ext4)
```

---

## âœ… éªŒè¯

### æ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿç±»å‹

```bash
# æ–¹æ³• 1: ä½¿ç”¨ lsblk
lsblk -f

# æ–¹æ³• 2: ä½¿ç”¨ blkid
blkid /dev/nvme0n1
blkid /dev/nvme1n1

# æ–¹æ³• 3: ä½¿ç”¨ df
df -T /root/sol/accounts
df -T /root/sol/ledger
```

### æ£€æŸ¥ fstab é…ç½®

```bash
grep -E "accounts|ledger|snapshot" /etc/fstab

# åº”è¯¥çœ‹åˆ°å®é™…çš„æ–‡ä»¶ç³»ç»Ÿç±»å‹ï¼š
# /dev/nvme0n1 /root/sol/accounts xfs defaults 0 0
# /dev/nvme1n1 /root/sol/ledger ext4 defaults 0 0
```

---

## ğŸ”’ å®‰å…¨ä¿è¯

1. âœ… **ä¸ä¼šæ ¼å¼åŒ–å·²æœ‰æ•°æ®**
   - åªåœ¨æ£€æµ‹åˆ°æ— æ–‡ä»¶ç³»ç»Ÿæ—¶æ‰æ ¼å¼åŒ–
   - ä¿ç•™æ‰€æœ‰ç°æœ‰çš„ XFS/EXT4/å…¶ä»–æ–‡ä»¶ç³»ç»Ÿ

2. âœ… **è‡ªåŠ¨å¤‡ä»½ fstab**
   - fix-mount-priority.sh ä¼šè‡ªåŠ¨å¤‡ä»½
   - æ ¼å¼ï¼š`/etc/fstab.backup.YYYYMMDD_HHMMSS`

3. âœ… **é”™è¯¯å¤„ç†**
   - æŒ‚è½½å¤±è´¥æ—¶åœæ­¢å¹¶æŠ¥é”™
   - ä¸ä¼šç»§ç»­æ‰§è¡Œå¯èƒ½æŸåæ•°æ®çš„æ“ä½œ

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **ä¸»å®‰è£…æŒ‡å—**: [README.md](README.md)
- **æŒ‚è½½ç­–ç•¥**: [MOUNT_STRATEGY.md](MOUNT_STRATEGY.md)
- **ä¼˜å…ˆçº§ä¿®å¤**: [MOUNT_FIX.md](MOUNT_FIX.md)
- **å¿«é€Ÿä¿®å¤æŒ‡å—**: [QUICK_FIX_PRIORITY.md](QUICK_FIX_PRIORITY.md)

---

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜ 1ï¼šæ£€æµ‹ä¸åˆ°æ–‡ä»¶ç³»ç»Ÿç±»å‹

```bash
# æ‰‹åŠ¨æ£€æŸ¥
blkid /dev/nvme0n1

# å¦‚æœè¾“å‡ºä¸ºç©ºï¼Œç£ç›˜å¯èƒ½éœ€è¦é‡æ–°æ ¼å¼åŒ–
# æˆ–è€…ä½¿ç”¨ fdisk/gdisk æŸ¥çœ‹åˆ†åŒºè¡¨
fdisk -l /dev/nvme0n1
```

### é—®é¢˜ 2ï¼šXFS æŒ‚è½½å¤±è´¥

```bash
# æ£€æŸ¥ XFS å·¥å…·æ˜¯å¦å®‰è£…
which mkfs.xfs
apt install xfsprogs  # Ubuntu/Debian

# æ£€æŸ¥ XFS æ–‡ä»¶ç³»ç»Ÿå¥åº·
xfs_repair -n /dev/nvme0n1
```

### é—®é¢˜ 3ï¼šfstab ç±»å‹ä¸åŒ¹é…

```bash
# æŸ¥çœ‹å®é™…æ–‡ä»¶ç³»ç»Ÿ
lsblk -f /dev/nvme0n1

# æŸ¥çœ‹ fstab é…ç½®
grep nvme0n1 /etc/fstab

# å¦‚æœä¸åŒ¹é…ï¼Œæ‰‹åŠ¨ä¿®æ­£æˆ–é‡æ–°è¿è¡Œè„šæœ¬
vim /etc/fstab
# æˆ–
bash 1-prepare.sh
```

---

**æ›´æ–°ç‰ˆæœ¬**: v1.2
**æ›´æ–°æ—¥æœŸ**: 2025-12-01
**ç»´æŠ¤è€…**: Solana RPC Team
